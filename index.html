<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 Project: Bar Chart</title>
</head>
<body>
    <h1>Bar Chart created with <a href="d3js.org">D3</a></h1>
    <div id="container"></div>

    <script type="module">
        //add d3
        import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm"
        async function main(url) { //wrap code in main function to support data fetch
            const set = [] //hold array of datapoints
            const promise = await fetch(url)
                .then((res) => {
                    return res.json();
                })
                .then((res) => {
                    for (let i = 0; i < res.data.length; i++) {
                        set.push(res.data[i])
                    }
                });

            console.log(set) //dataset has the array of data

            //height & width sizing, consider media queries
            const h = 500; const w = 500;
            //add an svg for the chart
            const svg = d3.create("svg").attr("width", w).attr('height', h)

            //chart has title with id="title"
            svg.append("title").attr("id", "title").text("USA Quarterly GDP, 1947-2015");

            //chart has g element x-axis id="x-axis"
            //x axis reflects date, need a scale
            //scale reflects start & end date in dataset
            const start = set[0][0].split('-');
            const end = set[set.length - 1][0].split('-')
            //note new Date() uses month index!
            const xScale = d3.scaleUtc([new Date(start[0], start[1] - 1, start[2]), new Date(end[0], end[1] - 1, end[2])])
            const xAx = svg.append('g').attr("id", "x-axis").attr("transform", `translate(0,${h - 10})`).call(d3.axisBottom(xScale))

            //successful display line, TODO: display ticks

            //chart has g element y-axis id="y-axis"
            const yAx = svg.append('g').attr("id", "y-axis")
            //y axis reflects gdp value

            //multiple labels on axes with class="tick"
            //rect element for each data point, class="bar"

            //each .bar has prop data-date and data-gdp with approp val

            //.bar data-date match order of data

            //.bar data-gdp match order of data

            //.bar height represents correponding GDP

            //data-date & corresponding .bar align with val on x-axis

            //data-gdp & corresponding .bar align with val on y-axis

            //show tooltip on mouse over an id="tooltip"

            //tooltip have data-date prop corresponds to data-date of active area


            //add svg to container div. d3 recognizes id els, no need to create var
            container.append(svg.node())

        }
        main("https://raw.githubusercontent.com/freeCodeCamp/ProjectReferenceData/master/GDP-data.json")
    </script>
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
</body>
</html>